<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>Simple File Manager</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 2em;
        }

        .file-list {
            margin-top: 2em;
        }

        .file-item {
            margin: 0.5em 0;
        }

        .login {
            margin-bottom: 2em;
        }
    </style>
</head>

<body>
    <div class="login">
        <h2>ç™»å½•</h2>
        <input type="text" id="username" placeholder="ç”¨æˆ·å">
        <input type="password" id="password" placeholder="å¯†ç ">
        <button onclick="login()">ç™»å½•</button>
        <div id="login-status"></div>
    </div>
    <div id="file-manager" style="display:none;">
        <h2>æ–‡ä»¶ç®¡ç†</h2>
        <form id="upload-form">
            <input type="file" id="file-input" name="file">
            <button type="submit">ä¸Šä¼ </button>
        </form>
        <div class="file-list" id="file-list"></div>
    </div>
    <script>
        let token = '';
        function login() {
            fetch('/api/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    username: document.getElementById('username').value,
                    password: document.getElementById('password').value
                })
            }).then(r => r.json()).then(data => {
                if (data.success) {
                    token = data.token;
                    document.getElementById('login-status').innerText = 'ç™»å½•æˆåŠŸ';
                    document.getElementById('file-manager').style.display = '';
                    loadFiles();
                } else {
                    document.getElementById('login-status').innerText = 'ç™»å½•å¤±è´¥';
                }
            });
        }
        function loadFiles() {
            fetch('/api/files', {
                headers: { 'Authorization': 'Bearer ' + token }
            }).then(r => r.json()).then(data => {
                let html = '';
                data.files.forEach(f => {
                    html += `<div class="file-item">${f.is_dir ? 'ğŸ“' : 'ğŸ“„'} ${f.name} ${!f.is_dir ? `<a href="/api/download?name=${encodeURIComponent(f.name)}&token=${token}">ä¸‹è½½</a>` : ''}</div>`;
                });
                document.getElementById('file-list').innerHTML = html;
            });
        }
        document.getElementById('upload-form').onsubmit = function (e) {
            e.preventDefault();
            let formData = new FormData();
            formData.append('file', document.getElementById('file-input').files[0]);
            fetch('/api/upload', {
                method: 'POST',
                headers: { 'Authorization': 'Bearer ' + token },
                body: formData
            }).then(r => r.json()).then(data => {
                if (data.success) loadFiles();
            });
        };
    </script>
</body>

</html>